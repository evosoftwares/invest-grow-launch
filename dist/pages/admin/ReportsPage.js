import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState } from "react";
import { AdminLayout } from "@/components/admin/AdminLayout";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Download, TrendingUp, Users, DollarSign, Target, Loader2, FileText } from "lucide-react";
import { useReportsData } from "@/hooks/useReportsData";
import { InvestmentChart } from "@/components/reports/InvestmentChart";
import { ChannelAnalysisChart } from "@/components/reports/ChannelAnalysisChart";
import { ConversionFunnelChart } from "@/components/reports/ConversionFunnelChart";
import { toast } from "@/components/ui/use-toast";
const ReportsPage = () => {
    const [timeRange, setTimeRange] = useState("30days");
    const { data: reportsData, isLoading, error } = useReportsData(timeRange);
    const handleExport = () => {
        toast({
            title: "Exportação iniciada",
            description: "O relatório será gerado e enviado por email em breve.",
        });
    };
    const formatCurrency = (value) => {
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }).format(value);
    };
    if (error) {
        return (_jsx(AdminLayout, { children: _jsx("div", { className: "flex items-center justify-center min-h-[400px]", children: _jsxs("div", { className: "text-center", children: [_jsx("p", { className: "text-red-600 mb-2", children: "Erro ao carregar dados dos relat\u00F3rios" }), _jsx("p", { className: "text-gray-500", children: error.message })] }) }) }));
    }
    return (_jsx(AdminLayout, { children: _jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "flex justify-between items-center", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-3xl font-bold text-gray-900", children: "Relat\u00F3rios e Analytics" }), _jsx("p", { className: "text-gray-600", children: "An\u00E1lises detalhadas de performance e capta\u00E7\u00E3o" })] }), _jsxs("div", { className: "flex space-x-2", children: [_jsxs(Select, { value: timeRange, onValueChange: setTimeRange, children: [_jsx(SelectTrigger, { className: "w-40", children: _jsx(SelectValue, {}) }), _jsxs(SelectContent, { children: [_jsx(SelectItem, { value: "7days", children: "\u00DAltimos 7 dias" }), _jsx(SelectItem, { value: "30days", children: "\u00DAltimos 30 dias" }), _jsx(SelectItem, { value: "90days", children: "\u00DAltimos 90 dias" }), _jsx(SelectItem, { value: "1year", children: "\u00DAltimo ano" })] })] }), _jsxs(Button, { onClick: handleExport, className: "bg-blue-600 hover:bg-blue-700", children: [_jsx(Download, { className: "w-4 h-4 mr-2" }), "Exportar"] })] })] }), isLoading ? (_jsxs("div", { className: "flex items-center justify-center py-8", children: [_jsx(Loader2, { className: "w-8 h-8 animate-spin mr-2" }), "Carregando relat\u00F3rios..."] })) : reportsData ? (_jsxs(_Fragment, { children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6", children: [_jsx(Card, { children: _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600", children: "Total Captado" }), _jsx("p", { className: "text-2xl font-bold text-green-600", children: formatCurrency(reportsData.investmentStats.totalCaptured) })] }), _jsx("div", { className: "p-3 bg-green-100 rounded-full", children: _jsx(DollarSign, { className: "h-6 w-6 text-green-600" }) })] }) }) }), _jsx(Card, { children: _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600", children: "Investimentos Ativos" }), _jsx("p", { className: "text-2xl font-bold text-blue-600", children: reportsData.conversionFunnel.investors })] }), _jsx("div", { className: "p-3 bg-blue-100 rounded-full", children: _jsx(Users, { className: "h-6 w-6 text-blue-600" }) })] }) }) }), _jsx(Card, { children: _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600", children: "Taxa de Convers\u00E3o" }), _jsxs("p", { className: "text-2xl font-bold text-purple-600", children: [reportsData.conversionFunnel.leads > 0 ?
                                                                    ((reportsData.conversionFunnel.investors / reportsData.conversionFunnel.leads) * 100).toFixed(1) : 0, "%"] })] }), _jsx("div", { className: "p-3 bg-purple-100 rounded-full", children: _jsx(Target, { className: "h-6 w-6 text-purple-600" }) })] }) }) }), _jsx(Card, { children: _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600", children: "Crescimento" }), _jsxs("p", { className: "text-2xl font-bold text-orange-600", children: [reportsData.monthlyInvestments.length > 1 ?
                                                                    reportsData.monthlyInvestments[reportsData.monthlyInvestments.length - 1].growth.toFixed(1) : 0, "%"] })] }), _jsx("div", { className: "p-3 bg-orange-100 rounded-full", children: _jsx(TrendingUp, { className: "h-6 w-6 text-orange-600" }) })] }) }) })] }), _jsx(InvestmentChart, { data: reportsData.monthlyInvestments }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsx(ChannelAnalysisChart, { data: reportsData.channelAnalysis }), _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Performance de Capta\u00E7\u00E3o" }) }), _jsx(CardContent, { children: _jsx("div", { className: "space-y-4", children: reportsData.monthlyInvestments.slice(-3).map((month, index) => (_jsxs("div", { className: "flex justify-between items-center p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg", children: [_jsxs("div", { children: [_jsx("p", { className: "font-medium", children: month.month }), _jsxs("p", { className: "text-sm text-gray-600", children: [month.investorCount, " investidores"] })] }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "text-xl font-bold text-green-600", children: formatCurrency(month.totalAmount) }), _jsxs("p", { className: `text-sm ${month.growth >= 0 ? 'text-green-600' : 'text-red-600'}`, children: [month.growth >= 0 ? '↗' : '↘', " ", Math.abs(month.growth).toFixed(1), "%"] })] })] }, month.month))) }) })] })] }), _jsx(ConversionFunnelChart, { data: reportsData.conversionFunnel }), reportsData.topPartners.length > 0 && (_jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Top Parceiros (Per\u00EDodo Selecionado)" }) }), _jsx(CardContent, { children: _jsx("div", { className: "space-y-4", children: reportsData.topPartners.slice(0, 5).map((partner, index) => (_jsxs("div", { className: "flex items-center justify-between p-4 border rounded-lg", children: [_jsxs("div", { className: "flex items-center", children: [_jsx("div", { className: `w-8 h-8 rounded-full flex items-center justify-center text-white font-bold mr-3 ${index === 0 ? 'bg-yellow-500' :
                                                                index === 1 ? 'bg-gray-400' :
                                                                    index === 2 ? 'bg-orange-500' : 'bg-blue-500'}`, children: index + 1 }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: partner.name }), _jsxs("p", { className: "text-sm text-gray-500", children: [partner.referrals, " indica\u00E7\u00F5es"] })] })] }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "font-semibold", children: formatCurrency(partner.totalAmount) }), _jsxs("p", { className: "text-sm text-gray-500", children: [formatCurrency(partner.commission), " comiss\u00E3o"] })] })] }, partner.id))) }) })] }))] })) : (_jsxs("div", { className: "text-center py-8", children: [_jsx(FileText, { className: "w-16 h-16 mx-auto text-gray-400 mb-4" }), _jsx("p", { className: "text-gray-500", children: "Nenhum dado dispon\u00EDvel para o per\u00EDodo selecionado" })] }))] }) }));
};
export default ReportsPage;
